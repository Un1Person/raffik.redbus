<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RedBus Data Input</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f4f7;
  padding: 20px;
}
.container {
  max-width: 950px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 10px;
}
textarea {
  width: 100%;
  height: 360px;
  padding: 12px;
  font-family: Consolas, monospace;
  font-size: 13px;
}
.actions {
  margin-top: 15px;
}
button {
  padding: 10px 18px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  margin-right: 10px;
}
.calc { background:#28a745;color:#fff }
.gen { background:#007bff;color:#fff }
.clear { background:#dc3545;color:#fff }
#result {
  margin-top: 12px;
  font-weight: bold;
}
</style>
</head>

<body>

<div class="container">
  <h2>Paste Raw Passenger Data</h2>

  <textarea id="rawData" placeholder="Paste full raw passenger data here..."></textarea>

  <div class="actions">
    <button class="calc" id="calcBtn">Calculate</button>
    <button class="gen" id="genBtn">Generate RedBus Numbers</button>
    <button class="clear" id="clearBtn">Clear</button>
  </div>

  <div id="result"></div>
</div>

<script>
const BOARDING_POINTS = [
  "siruseri","navalur","sathyabama university gate","shollinganallur",
  "thuraipakkam","perungudi","srp tools","tidel park",
  "madhya kailash temple","anna university","guindy olympia tech park",
  "ashok pillar","vadapalani","koyembedu","anna nagar","lucas tvs",
  "senthil nagar","retteri","madhavaram","puzhal central jail",
  "red hills","rmk college","gummidipundi"
];

// ðŸ”¹ CORE PARSER (same as redbus.html)
function extractRedbusNumbers(raw) {
  const lines = raw.split("\n").map(l => l.trim()).filter(Boolean);

  let records = [];
  let current = [];

  lines.forEach(line => {
    if (/^\d{6,7}$/.test(line)) {
      if (current.length) records.push(current);
      current = [line];
    } else {
      current.push(line);
    }
  });
  if (current.length) records.push(current);

  let numbers = [];

  records.forEach(rec => {
    const block = rec.join(" ").toLowerCase();

    // must END with redbus - Post
    if (!rec.some(l => l.toLowerCase().endsWith("redbus - post"))) return;

    // must contain Hyderabad
    if (!block.includes("hyderabad")) return;

    // must contain one valid boarding point
    const hasBoarding = BOARDING_POINTS.some(bp => block.includes(bp));
    if (!hasBoarding) return;

    // extract phone
    const phoneLine = rec.find(l =>
      /\b\d{10}\b/.test(l) &&
      !l.includes("8886619050") &&
      !l.includes("0000000000")
    );
    if (!phoneLine) return;

    const phone = phoneLine.match(/\b\d{10}\b/)[0];
    if (!numbers.includes(phone)) numbers.push(phone);
  });

  return numbers;
}

// ðŸ”¹ BUTTON EVENTS
document.getElementById("calcBtn").onclick = () => {
  const raw = document.getElementById("rawData").value.trim();
  if (!raw) {
    alert("Paste raw data first");
    return;
  }
  const nums = extractRedbusNumbers(raw);
  document.getElementById("result").innerText =
    `Total RedBus Numbers: ${nums.length}`;
};

document.getElementById("genBtn").onclick = () => {
  const raw = document.getElementById("rawData").value.trim();
  if (!raw) {
    alert("Paste raw data first");
    return;
  }
  localStorage.setItem("RAW_PASSENGER_DATA", raw);
  window.open("redbus.html", "_blank");
};

document.getElementById("clearBtn").onclick = () => {
  document.getElementById("rawData").value = "";
  document.getElementById("result").innerText = "";
  localStorage.removeItem("RAW_PASSENGER_DATA");
};
</script>

</body>
</html>
